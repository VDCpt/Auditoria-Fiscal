<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatório de Auditoria Fiscal TVDE (VDC)</title>
    <style>
        /* [Mantive os seus estilos originais por brevidade, mas otimizados para o motor de renderização] */
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f9; }
        .container { max-width: 900px; margin: 0 auto; background-color: #fff; padding: 25px; box-shadow: 0 0 10px rgba(0,0,0,0.1); border-radius: 8px; }
        h1, h2 { text-align: center; color: #333; }
        .filename-box { display: block; text-align: center; font-size: 1.1em; font-weight: bold; color: #007bff; margin-bottom: 25px; padding: 10px; border: 1px dashed #007bff; background-color: #e6f7ff; border-radius: 4px; }
        .columns-container { display: flex; justify-content: space-between; gap: 30px; margin-top: 30px; }
        .column { flex: 0 0 48%; padding: 20px; border: 1px solid #ddd; border-radius: 6px; background-color: #ffffff; }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 5px; font-weight: 500; }
        .input-group input, .input-group select { width: 100%; padding: 10px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
        .result-group { padding: 15px; border-top: 1px solid #ccc; margin-top: 15px; background-color: #f9f9f9; border-radius: 4px; }
        .auditoria-section { margin-top: 40px; padding: 25px; border: 2px solid #a33; background-color: #ffeaea; border-radius: 8px; }
        .discrepancy { font-size: 1.4em; font-weight: bold; color: #d9534f; margin: 15px 0; padding: 15px; border: 1px dashed #d9534f; background-color: #fdd; text-align: center; }
        .button-container { display: flex; gap: 15px; margin-top: 30px; }
        .action-button { flex: 1; padding: 15px; border: none; border-radius: 5px; font-size: 1.1em; cursor: pointer; color: white; }
        .calculate { background-color: #28a745; }
        .print { background-color: #007bff; }
        
        @media print {
            .button-container, input, select { display: none !important; }
            span.print-only { display: inline-block !important; font-weight: bold; }
            .column { width: 100%; border: 1px solid #ccc; margin-bottom: 10px; page-break-inside: avoid; }
            .columns-container { display: block; }
        }
        .print-only { display: none; }
    </style>
</head>
<body>

<div class="container" id="printableArea">
    <h1>Relatório de Auditoria Fiscal TVDE</h1>
    <div class="filename-box" id="filenameDisplay">ANALISE_DISCREPANCIA_FISCAL.pdf</div>

    <div class="columns-container">
        <div class="column">
            <h3>1. Ganhos na APP (Operacional)</h3>
            <div class="input-group">
                <label>Ganhos Brutos (€):</label>
                <input type="number" id="ganhosBrutos" value="1750.00" step="0.01">
            </div>
            <div class="input-group">
                <label>Taxas de Reserva (Dedução) (€):</label>
                <input type="number" id="taxasReservaDeducoes" value="20.74" step="0.01">
            </div>
            <div class="input-group">
                <label>Comissão Plataforma (Retida) (€):</label>
                <input type="number" id="comissaoPlataforma" value="400.00" step="0.01">
            </div>
            <div class="result-group">
                <label>Base Tributável Operacional (BTOR):</label>
                <strong id="btorDisplay">0.00 €</strong>
            </div>
        </div>

        <div class="column">
            <h3>2. Fatura Emitida (Fiscal)</h3>
            <div class="input-group">
                <label>Valor da Comissão em Fatura (€):</label>
                <input type="number" id="baseTributavelFaturada" value="350.00" step="0.01">
            </div>
            <div class="input-group">
                <label>Motoristas Ativos (Média Mercado):</label>
                <input type="number" id="motoristasAtivos" value="38638">
            </div>
            <div class="result-group" style="background-color: #fffbe6;">
                <label>Base Tributável Faturada (BTF):</label>
                <strong id="btfDisplay">0.00 €</strong>
            </div>
        </div>
    </div>

    <div class="auditoria-section">
        <h2>Resultado da Discrepância</h2>
        <div class="discrepancy">
            <span id="discrepanciaValor">0.00 €</span>
        </div>
        <p>Omissão por Unidade: <strong id="omissaoUnidade">0.00 €</strong></p>
        <p><strong>Impacto Estimado Mensal (Mercado):</strong> <span id="impactoMensal" style="font-weight:bold; color:#a33;">0.00 €</span></p>
    </div>

    <div class="button-container">
        <button class="action-button calculate" onclick="calcularAuditoria()">Calcular / Atualizar</button>
        <button class="action-button print" onclick="window.print()">Gerar Prova PDF</button>
    </div>
</div>

<script>
function calcularAuditoria() {
    // 1. Obter Valores dos Inputs
    const brutos = parseFloat(document.getElementById('ganhosBrutos').value) || 0;
    const taxasReserva = parseFloat(document.getElementById('taxasReservaDeducoes').value) || 0;
    const comissaoRetida = parseFloat(document.getElementById('comissaoPlataforma').value) || 0;
    const btf = parseFloat(document.getElementById('baseTributavelFaturada').value) || 0;
    const motoristas = parseInt(document.getElementById('motoristasAtivos').value) || 0;

    // 2. Lógica de Cálculo
    // A BTOR é a soma do que a plataforma reteve efetivamente do motorista (Comissão + Taxas de Reserva)
    const btor = comissaoRetida + taxasReserva;
    
    // Discrepância por amostra
    const discrepancia = btor - btf;
    
    // Extrapolação
    const totalOmitidoMensal = discrepancia * motoristas;

    // 3. Atualizar Interface
    document.getElementById('btorDisplay').innerText = btor.toFixed(2) + " €";
    document.getElementById('btfDisplay').innerText = btf.toFixed(2) + " €";
    document.getElementById('discrepanciaValor').innerText = discrepancia.toFixed(2) + " €";
    document.getElementById('omissaoUnidade').innerText = discrepancia.toFixed(2) + " €";
    
    // Formatação de moeda para grandes valores
    document.getElementById('impactoMensal').innerText = new Intl.NumberFormat('pt-PT', { 
        style: 'currency', 
        currency: 'EUR' 
    }).format(totalOmitidoMensal);

    // 4. Dinamismo do Nome do Ficheiro (Opcional)
    const data = new Date();
    document.getElementById('filenameDisplay').innerText = 
        `${data.getFullYear()}_${data.getMonth()+1}_AUDITORIA_TVDE_ID.pdf`;
}

// Executar cálculo inicial ao carregar
window.onload = calcularAuditoria;
</script>

</body>
</html>
